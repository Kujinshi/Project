## Общая информация

### Адрес
#### Таблица location
####

id                              | city                         | street                       | adress                       | post-code       | email                   | phone            | url       | 
--------------------------------|:----------------------------:|:----------------------------:|:----------------------------:|:---------------:|:-----------------------:|:----------------:|:---------:|
id места проведения мероприятия | город проведения мероприятия | улица проведения мероприятия | адрес проведения мероприятия | почтовый индекс | адрес электронной почты | номера телефонов | веб-адрес |

### Направление подготовки
https://base.garant.ru/70480868/53f89421bbdaf741eb2d1ecc4ddb4c33/
#### Таблица specialization
####

id                        | code                                 | name                            |
--------------------------|:------------------------------------:|:-------------------------------:|
id направления подготовки | кодовый номер направления подготовки | название направления подготовки |

### Структурное подразделение
#### Таблица division
####

id                            | parent | name                                |
------------------------------|:------:|:-----------------------------------:|
id структурного подразделения | парент | название структурного подразделения |

### Хранилище файлов

uid - generate next uid if file exists
path = уникальный путь к файлу
(uid = 0: scope/sha2(file-content), uid > 0: scope/sha2(sha2(file-content)+uid))
scope = system|employee|course
hash = sha2(file-content)
Например: файл abc.png прикрепляется к предмету
id: 1, mimetype: 'image/png', scope: 'course', uid: 0, hash: 'abb1865ce4168d942bff8a9fe6fa5a74362ca931e4b17f4348111ccc6b1ce82b' path: 'course/abb1865ce4168d942bff8a9fe6fa5a74362ca931e4b17f4348111ccc6b1ce82b'
#### Таблица storage
####  

id                  | mimetype       | filename  | scope        | uid                 | hash      | path         | created                     | createdby   | modified                          | modifiedby        |
--------------------|:--------------:|:---------:|:------------:|:-------------------:|:---------:|:------------:|:---------------------------:|:-----------:|:---------------------------------:|:-----------------:|
id хранилища файлов | mime-тип файла | имя файла | размер файла | идентификатор файла | хеш файла | путь к файлу | дата и время создания файла | кем создано | дата и время редактирования файла | кем редактировано |

## Расписание занятий

### Название шкалы времени проведения занятий
#### Таблица timetable
####

id                                  | name                                      | type                                                                     | established                                        | cancelled                                    |
------------------------------------|:-----------------------------------------:|:------------------------------------------------------------------------:|:--------------------------------------------------:|:--------------------------------------------:|
id шкалы времени проведения занятий | название шкалы времени проведения занятий | тип шкалы времени проведения занятий (r - , a - абсюлютные дата и время) | дата установления шкалы времени проведения занятий | дата отмены шкалы времени проведения занятий |


### Временные промежутки проведения занятий
#### Таблица timetable_timeinterval
####

id                                          | timetable     | start                | finish                  |
--------------------------------------------|:-------------:|:--------------------:|:-----------------------:|
id временных промежутков проведения занятий | id расписания | время начала занятия | время окончания занятия |

## Пользователи

### Пользователь
#### Таблица user
####

id              | firstname | middlename | lastname | birthday      | status                                                                                           | email                   | password | phones          | photo | created                  | modified                             | lastaccess                              |
----------------|:---------:|:----------:|:--------:|:-------------:|:------------------------------------------------------------------------------------------------:|:-----------------------:|:--------:|:---------------:|:-----:|:------------------------:|:------------------------------------:|:---------------------------------------:|
id пользователя | имя       | отчество   | фамилия  | дата рождения | статус(с - подтверждение электронной почты, a - активный, d - отключенный, d - деактивированный) | адрес электронной почты | пароль   | номера телефона | фото  | дата и время регистрации | дата и время редактирования аккаунта | дата и время последнего входа в аккаунт |

### Должность сотрудника
#### Таблица position
####

id           | parent | name               |
-------------|:------:|:------------------:|
id должности | парент | название должности |

### Ученая степень сотрудника
#### Таблица degree
####

id                | parent | name                    |
------------------|:------:|:-----------------------:|
id учёной степени | парент | название учёной степени |

### Сотрудник 
#### Таблица employee
####

id            | user            | division                      | position                | degree                       |
--------------|:---------------:|:-----------------------------:|:-----------------------:|:----------------------------:|
id сотрудника | id пользователя | id структурного подразделения | id должности сотрудника | id учёной степени сотрудника |

### Студенческая группа
#### Таблица student_group
####

id                     | division                      | specialization            | name                         | formed                                     |
-----------------------|:-----------------------------:|:-------------------------:|:----------------------------:|:------------------------------------------:|
id студенческой группы | id структурного подразделения | id направления подготовки | название студенческой группы | описание дата создания студенческой группы |

### Студент
#### Таблица sptudent
####

id          | user                                                  | group                  |
------------|:-----------------------------------------------------:|:----------------------:|
id студента | id пользователя (пользовательского аккаунта студента) | id студенческой группы |

## Безопасность

//  function require_capability(scope, capability) {
//    // capability=identifier
//    if (!has_capability(scope, {course: current_course, user: current_user}, capability)) {
//      throw new Error('Permission denied');
//    }
//  }
//  require_capability('course', 'approve')

### Роль

// scope=system: Administrator
// scope=employee: Administator, Department manager
// scope=course: Teacher, Assistant (viewer), Approver, Editor, Manager, Support
// operations: read, write, approve, teach, schedule (change), support

#### Таблица security_role
####

id       | parent | identifier         | name     | description   |
---------|:------:|:------------------:|:--------:|:-------------:|
id  роли | парент | идентификатор роли | имя роли | описание роли |

### Элементы безопасности
#### Таблица security_capability
####

id                       | user                             | division                               | position                          |
-------------------------|:--------------------------------:|:--------------------------------------:|:---------------------------------:|
id элемента безопасности | id масштаб элемента безопасности | id идентификатор элемента безопасности | id название элемента безопасности |

### Права доступа к элементу безопасности для роли 
#### Таблица security_permission
id                                               | role    | capibility               | acces                                                                     |
-------------------------------------------------|:-------:|:------------------------:|:-------------------------------------------------------------------------:|
id прав доступа к элементу безопасности для роли | id роли | id элемента безопасности | тип доступа (g - разрешен, r - аннулирован, d - отказан, i - унаследован) |

### Назначение роли сотруднику с уточнением объекта бе
// role employee | role employee division | role employee course
#### Таблица security_object
####

id                                                 | role                 | employee      | division                      | event          | cource            |
---------------------------------------------------|:--------------------:|:-------------:|:-----------------------------:|:--------------:|:-----------------:|
id назначения роли сотруднику с уточнением объекта | id роли безопасности | id сотрудника | id структурного подразделения | id мероприятия | id курса/предмета |

## Мероприятия 

### Мероприятие

// maxcourses - Максимальное количество предметов, которое может выбрать студент
// maxgrade - Максимальное количество баллов, которое может выбрать студент
// maxduration - Максимальное количество времени, которое может выбрать студент
// timetable - Временная сетка для предметов в рамках мероприятия
// timetable_option 
//   s - строгое соответствие, 
//   o - опциональное (могут быть несоответствия), 
//   f - без временной сетки

#### Таблица event
####

id             | type                                | start              | finish               | timetable_option                                               | timetable     | mincources                                              | maxcources                                               | mingrade                                                | maxgrade                                                 | minduration                                              | maxduration                                               | description          | created                   | createdby   | modified                                   | modifiedby        |
---------------|:-----------------------------------:|:------------------:|:--------------------:|:--------------------------------------------------------------:|:-------------:|:-------------------------------------------------------:|:--------------------------------------------------------:|:-------------------------------------------------------:|:--------------------------------------------------------:|:--------------------------------------------------------:|:---------------------------------------------------------:|:--------------------:|:-------------------------:|:-----------:|:------------------------------------------:|:-----------------:|
id мероприятия | тип мероприятия (n - НАМ, m - МУАМ) | дата начала  курса | дата окончания курса | тип расписания (s - строгое, o - опционлальное, f - свободное) | id расписания | минимальное число курсов, которое может выбрать студент | максимальное число курсов, которое может выбрать студент | минимальное число баллов, которое может выбрать студент | максимальное число баллов, которое может выбрать студент | минимальное число времени, которое может выбрать студент | максимальное число времени, которое может выбрать студент | описание мероприятия | дата создания мероприятия | кеи создано | Дата последнего редактирования мероприятия | кем редактировано |


### Предметы
#### Таблица cource
#### 

id                | event                                        | division                                    | status                                                                | name                    | maxstudents                  | maxgrade            | description            | created             | createdby   | modified                             | modifiedby        |
-----------------:|:--------------------------------------------:|:-------------------------------------------:|:---------------------------------------------------------------------:|:-----------------------:|:----------------------------:|:-------------------:|:----------------------:|:-------------------:|:-----------:|:------------------------------------:|:-----------------:|
id курса/предмета | мероприятие в рамках данного курса/предмета  | подразделение, которое проводит мероприятие | e - редактируется, a - одобрено, p - опубликовано, u - неопубликовано | название курса/предмета | максимальное число студентов | максимальная оценка | краткое описание курса | дата создания курса | кем создано | дата последнего редактирования курса | кем редактировано |       

### Список направлений подготовки, для которых можно выбрать данный предмет

// constraints varchar(255)
// ??? constraints - ограничения на курс 1,2,3,4 или группы

#### Таблица course_specialization
####

id                                                            | cource                                                     | specialization            |
--------------------------------------------------------------|:----------------------------------------------------------:|:-------------------------:|
id направления подготовки, для которого можно выбрать предмет | направления подготовки, для которого можно выбрать предмет | название расписания курса | 

### Тип файла во вложении
#### Таблица course_attachment_type
####

id                        | event          | status                                                       | name                            | mimetypes      | maxsize                   |
--------------------------|:--------------:|:------------------------------------------------------------:|:-------------------------------:|:--------------:|:-------------------------:|
id типа файла во вложении | id мероприятия | татус вложенного файла (r - обязательный, o - опционлальный) | название типа файла во вложении | mime-тип файла | максимальный размер файла | 


### Вложение у курса
#### Таблица course_attachment
####

id                   | cource            | type                      | name      | storage             |
---------------------|:-----------------:|:-------------------------:|:---------:|:-------------------:|
id файла во вложении | id курса/предмета | id типа файла во вложении | имя файла | id хранилища файлов |

## Расписание предмета и его отдельных тем 
// couse start | course start name
// В учебных заведениях используется расписание занятий, привязанное к времени проведения занятий. В рамках мероприятия может быть одна сетка. Эта сетка задается в event.timetable. В поля start, finish указывается реальное время проведения занятий для НАМ. Для повторяющихся занятий как в МУАМ указывается дата и время их начала и окончания и относительное время в timeinterval.

#### Таблица course_shedule
####

id                           | cource                             | timeinterval               | start                      | finish                        | name                    | description              | location                 | url    |
-----------------------------|:----------------------------------:|:--------------------------:|:--------------------------:|:-----------------------------:|:-----------------------:|:------------------------:|:------------------------:|:------:|
id расписания курса/предмета | название расписания курса/предмета | временной интервал занятий | дата начала курса/предмета | дата окончания курса/предмета | название курса/предмета | описание курса/предмета  | место проведения занятий | ссылка |

### Роль в рамках курса
#### Таблица course_role
####

id                     | cource                       | student     |
-----------------------|:----------------------------:|:-----------:|
id роли в рамках курса | название роли в рамках курса | id студента |


### Закрепленные за курсом преподаватели
#### Таблица course_employee
####

id                     | cource            | employee         | role    |
-----------------------|:-----------------:|:----------------:|:-------:| 
id преподавателя курса | id курса/предмета | id преподавателя | id роли |

### Закрепленные за курсом студенты
#### Таблица course_enrollment
####

id                                   | cource            | student                                  | enrolled                              | deducted                                    |
-------------------------------------|:-----------------:|:----------------------------------------:|:-------------------------------------:|:-------------------------------------------:|
id студентов, закрепленных за курсом | id курса/предмета | id студента, записанного на курс/предмет | время записи студента на курс/предмет | время окончания студентом прохождения курса |

### Таблица процента реализации оценки/посещения для course_schedule 0-100 - course.maxgrade/course.maxduration 
#### Таблица course_complection
####

id | enrolled_student                  | cource_shedule            | type                                              | value                   |
---|:---------------------------------:|:-------------------------:|:-------------------------------------------------:|:-----------------------:|
id | id зачисленного на курс студента  | id графика курса/предмета | тип курса/предмета (a - посещаемость, g - оценки) | ценность курса/предмета |